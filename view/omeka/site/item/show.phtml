<?php
$translate = $this->plugin('translate');
$this->headLink()->appendStylesheet($this->assetUrl('css/resource-page-blocks.css', 'Omeka'));
$this->htmlElement('body')->appendAttribute('class', 'item resource show');
$filterLocale = (bool) $this->siteSetting('filter_locale_values');
$lang = $this->lang();
$valueLang = $filterLocale ? [$lang, ''] : null;

$itemMedia = $item->media();

$useMediaRender = false;
$useMiradorViewer = false;
$useUniversalViewer = false;

foreach ($itemMedia as $media) {
    $mediaType = $media->mediaType();
    $mediaRenderer = $media->renderer();

    if (($mediaRenderer !== null && strpos($mediaRenderer, 'iiif') !== false) || 
        ($mediaType !== null && $mediaType === 'image/jpeg')) {
        $useMiradorViewer = true;
    } elseif ($mediaType !== null && strpos($mediaType, 'pdf') !== false) {
        $useUniversalViewer = true;
    } else {
        $useMediaRender = true;
        break;
    }
}

?>

<?php echo $this->pageTitle($item->displayTitle(null, $valueLang), 2); ?>
<h3><?php echo $translate('Item'); ?></h3>

<?php $this->trigger('view.show.before'); ?>

<?php 
$viewerMethods = [
    'useMiradorViewer'=> 'mirador',
    'useUniversalViewer' => 'universalViewer',
    'useMediaRender' => 'render',
];
foreach ($viewerMethods as $viewerFlag => $viewerMethod):
    if ($$viewerFlag): ?>
        <?php echo $this->$viewerMethod($item); ?>
    <?php endif;
endforeach;
?>

<?php echo $this->resourcePageBlocks($item)->getBlocks(); ?>
